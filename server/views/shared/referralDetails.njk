{% extends "../partials/referralNavigationTemplate.njk" %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}


{% set pageTitle = "Referral" %}
{% set pageSubTitle = "Details" %}

{% block referralPageSection %}
      {% if presenter.userType == 'probation-practitioner' %}
        {{ govukInsetText(insetTextArgs) }}
      {% endif %}

      {% if presenter.referralAssigned %}
        <p class="govuk-body">This intervention is assigned to <strong>{{ presenter.assignedCaseworkerFullName }}</strong> (<a href="mailto:{{ presenter.assignedCaseworkerEmail }}">{{ presenter.assignedCaseworkerEmail }}</a>).</p>
      {% endif %}

      {% if presenter.canAssignReferral %}
        <h2 class="govuk-heading-m">Who do you want to assign this referral to?</h2>
        <form method="post" action={{ presenter.assignmentFormAction }}>
              <input type="hidden" name="_csrf" value="{{csrfToken}}">
              {{ govukInput(emailInputArgs) }}
              {{ govukButton({ text: "Save and continue" }) }}
        </form>
      {% elif not presenter.referralAssigned %}
        <p class="govuk-body">{{ presenter.text.noCaseworkerAssigned }}</p>
      {% endif %}

      {{ govukSummaryList(interventionDetailsSummaryListArgs) }}

      {%  for section in serviceCategorySections %}
        {{ govukSummaryList(section.summaryListArgs(govukTag)) }}
      {% endfor %}
      {%  if responsibleOfficerSummaryListArgs | length %}
          {{ govukSummaryList(responsibleOfficerSummaryListArgs) }}
      {% else %}
          <p class="govuk-body">No responsible officer details found in nDelius. Email notifications for this referral will be sent to the referring officer.</p>
      {% endif %}     

      {{ govukSummaryList(probationPractitionerSummaryListArgs) }}

      {{ govukSummaryList(serviceUserLocationDetailsSummaryListArgs) }}

      {{ govukSummaryList(serviceUserDetailsSummaryListArgs) }}

      {% if presenter.roshPanelPresenter.riskInformationAvailable %}

        <p class="govuk-body">This shows their Risk of Serious Harm (ROSH) levels. Additional information from the probation practitioner may also be shown.</p>

        {{ govukTable(roshAnalysisTableArgs(govukTag)) }}

        {{ govukDetails(riskLevelDetailsArgs) }}

      {% endif %}

      {% if presenter.canShowFullSupplementaryRiskInformation %}
         {{ govukSummaryList(riskInformationArgs) }}
      {% else %}
        {{ govukSummaryList(serviceUserRisksSummaryListArgs) }}
      {% endif %}

      {{ govukSummaryList(serviceUserNeedsSummaryListArgs) }}

{% endblock %}
